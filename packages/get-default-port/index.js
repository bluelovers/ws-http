"use strict";
/**
 * Created by user on 2020/3/16.
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.getDefaultPort = exports.getPortEnv = exports.iifFallbackPort = void 0;
function iifFallbackPort(port, ports) {
    port = port | 0;
    if (port <= 0 && ports) {
        if (Array.isArray(ports)) {
            for (let p of ports) {
                port = p | 0;
                if (port > 0) {
                    break;
                }
            }
        }
        else {
            port = ports | 0;
        }
    }
    return port > 0 ? port : 0;
}
exports.iifFallbackPort = iifFallbackPort;
/**
 * OPENSHIFT_NODEJS_PORT
 * VCAP_APP_PORT
 * PORT
 */
function getPortEnv() {
    return iifFallbackPort(0, [
        process.env.OPENSHIFT_NODEJS_PORT,
        process.env.VCAP_APP_PORT,
        process.env.NODE_PORT,
        process.env.PORT,
    ]);
}
exports.getPortEnv = getPortEnv;
function getDefaultPort(options = {}) {
    const { preferPorts, fallbackPorts, defaultPort } = options;
    let port;
    port = iifFallbackPort(port, preferPorts);
    if (port === 0 && typeof process !== 'undefined' && (process === null || process === void 0 ? void 0 : process.env)) {
        port = getPortEnv();
    }
    port = iifFallbackPort(port, fallbackPorts);
    return port || defaultPort && iifFallbackPort(defaultPort, 0) || 3000;
}
exports.getDefaultPort = getDefaultPort;
exports.default = getDefaultPort;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7OztBQUlILFNBQWdCLGVBQWUsQ0FBQyxJQUFxQixFQUFFLEtBQWtCO0lBRXhFLElBQUksR0FBSSxJQUFlLEdBQUcsQ0FBQyxDQUFDO0lBRTVCLElBQUksSUFBSSxJQUFJLENBQUMsSUFBSSxLQUFLLEVBQ3RCO1FBQ0MsSUFBSSxLQUFLLENBQUMsT0FBTyxDQUFDLEtBQUssQ0FBQyxFQUN4QjtZQUNDLEtBQUssSUFBSSxDQUFDLElBQUksS0FBSyxFQUNuQjtnQkFDQyxJQUFJLEdBQUksQ0FBWSxHQUFHLENBQUMsQ0FBQztnQkFFekIsSUFBSSxJQUFJLEdBQUcsQ0FBQyxFQUNaO29CQUNDLE1BQU07aUJBQ047YUFDRDtTQUNEO2FBRUQ7WUFDQyxJQUFJLEdBQUksS0FBZ0IsR0FBRyxDQUFDLENBQUM7U0FDN0I7S0FDRDtJQUVELE9BQU8sSUFBSSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDNUIsQ0FBQztBQXpCRCwwQ0F5QkM7QUFFRDs7OztHQUlHO0FBQ0gsU0FBZ0IsVUFBVTtJQUV6QixPQUFPLGVBQWUsQ0FBQyxDQUFDLEVBQUU7UUFDekIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUI7UUFDakMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhO1FBQ3pCLE9BQU8sQ0FBQyxHQUFHLENBQUMsU0FBUztRQUNyQixPQUFPLENBQUMsR0FBRyxDQUFDLElBQUk7S0FDaEIsQ0FBQyxDQUFDO0FBQ0osQ0FBQztBQVJELGdDQVFDO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLFVBSTNCLEVBQUU7SUFFTCxNQUFNLEVBQUUsV0FBVyxFQUFFLGFBQWEsRUFBRSxXQUFXLEVBQUUsR0FBRyxPQUFPLENBQUM7SUFFNUQsSUFBSSxJQUFxQixDQUFDO0lBRTFCLElBQUksR0FBRyxlQUFlLENBQUMsSUFBSSxFQUFFLFdBQVcsQ0FBQyxDQUFDO0lBRTFDLElBQUksSUFBSSxLQUFLLENBQUMsSUFBSSxPQUFPLE9BQU8sS0FBSyxXQUFXLEtBQUksT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLEdBQUcsQ0FBQSxFQUNoRTtRQUNDLElBQUksR0FBRyxVQUFVLEVBQUUsQ0FBQztLQUNwQjtJQUVELElBQUksR0FBRyxlQUFlLENBQUMsSUFBSSxFQUFFLGFBQWEsQ0FBQyxDQUFDO0lBRTVDLE9BQU8sSUFBSSxJQUFJLFdBQVcsSUFBSSxlQUFlLENBQUMsV0FBVyxFQUFFLENBQUMsQ0FBQyxJQUFJLElBQUksQ0FBQTtBQUN0RSxDQUFDO0FBcEJELHdDQW9CQztBQUVELGtCQUFlLGNBQWMsQ0FBQSIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMjAvMy8xNi5cbiAqL1xuXG5leHBvcnQgdHlwZSBJUG9ydHNJbnB1dCA9IHN0cmluZyB8IG51bWJlciB8IChudW1iZXIgfCBzdHJpbmcpW107XG5cbmV4cG9ydCBmdW5jdGlvbiBpaWZGYWxsYmFja1BvcnQocG9ydDogc3RyaW5nIHwgbnVtYmVyLCBwb3J0czogSVBvcnRzSW5wdXQpOiBudW1iZXJcbntcblx0cG9ydCA9IChwb3J0IGFzIG51bWJlcikgfCAwO1xuXG5cdGlmIChwb3J0IDw9IDAgJiYgcG9ydHMpXG5cdHtcblx0XHRpZiAoQXJyYXkuaXNBcnJheShwb3J0cykpXG5cdFx0e1xuXHRcdFx0Zm9yIChsZXQgcCBvZiBwb3J0cylcblx0XHRcdHtcblx0XHRcdFx0cG9ydCA9IChwIGFzIG51bWJlcikgfCAwO1xuXG5cdFx0XHRcdGlmIChwb3J0ID4gMClcblx0XHRcdFx0e1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fVxuXHRcdGVsc2Vcblx0XHR7XG5cdFx0XHRwb3J0ID0gKHBvcnRzIGFzIG51bWJlcikgfCAwO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiBwb3J0ID4gMCA/IHBvcnQgOiAwO1xufVxuXG4vKipcbiAqIE9QRU5TSElGVF9OT0RFSlNfUE9SVFxuICogVkNBUF9BUFBfUE9SVFxuICogUE9SVFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0UG9ydEVudigpXG57XG5cdHJldHVybiBpaWZGYWxsYmFja1BvcnQoMCwgW1xuXHRcdHByb2Nlc3MuZW52Lk9QRU5TSElGVF9OT0RFSlNfUE9SVCxcblx0XHRwcm9jZXNzLmVudi5WQ0FQX0FQUF9QT1JULFxuXHRcdHByb2Nlc3MuZW52Lk5PREVfUE9SVCxcblx0XHRwcm9jZXNzLmVudi5QT1JULFxuXHRdKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldERlZmF1bHRQb3J0KG9wdGlvbnM6IHtcblx0cHJlZmVyUG9ydHM/OiBJUG9ydHNJbnB1dCxcblx0ZmFsbGJhY2tQb3J0cz86IElQb3J0c0lucHV0LFxuXHRkZWZhdWx0UG9ydD86IG51bWJlcixcbn0gPSB7fSk6IG51bWJlclxue1xuXHRjb25zdCB7IHByZWZlclBvcnRzLCBmYWxsYmFja1BvcnRzLCBkZWZhdWx0UG9ydCB9ID0gb3B0aW9ucztcblxuXHRsZXQgcG9ydDogbnVtYmVyIHwgc3RyaW5nO1xuXG5cdHBvcnQgPSBpaWZGYWxsYmFja1BvcnQocG9ydCwgcHJlZmVyUG9ydHMpO1xuXG5cdGlmIChwb3J0ID09PSAwICYmIHR5cGVvZiBwcm9jZXNzICE9PSAndW5kZWZpbmVkJyAmJiBwcm9jZXNzPy5lbnYpXG5cdHtcblx0XHRwb3J0ID0gZ2V0UG9ydEVudigpO1xuXHR9XG5cblx0cG9ydCA9IGlpZkZhbGxiYWNrUG9ydChwb3J0LCBmYWxsYmFja1BvcnRzKTtcblxuXHRyZXR1cm4gcG9ydCB8fCBkZWZhdWx0UG9ydCAmJiBpaWZGYWxsYmFja1BvcnQoZGVmYXVsdFBvcnQsIDApIHx8IDMwMDBcbn1cblxuZXhwb3J0IGRlZmF1bHQgZ2V0RGVmYXVsdFBvcnRcbiJdfQ==